<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ 'New ' + category_label + ' habit' if mode=='new' else 'Edit habit' }}</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/habit_form.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">

  <!-- Fuente Poppins (asegura uniformidad tipogr√°fica) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>

<body>

<div class="layout">

  <!-- Sidebar actualizado -->
<aside id="sidebar" class="sidebar expanded">

    <button id="toggle-btn" class="toggle-btn">‚ò∞</button>

    <!-- USER INFO -->
    <div class="user-section">
        <div class="avatar">
            <img src="/static/img/flower.png" alt="User avatar">
        </div>
        <span class="username">{{ session['username'] }}</span>
    </div>

    <!-- MENU -->
    <nav class="menu">
      <a class="menu-item active" href="{{ url_for('main.dashboard') }}">
        <span class="item-icon">‚úî</span>
        <span class="item-text">My habits</span>
      </a>

      <a class="menu-item" href="{{ url_for('main.calendar_view') }}">
        <span class="item-icon">üìÖ</span>
        <span class="item-text">Calendar</span>
      </a>
    </nav>

    <!-- LOGOUT -->
    <a class="logout-section" href="{{ url_for('main.logout') }}">
      <span class="logout-icon">‚èª</span>
      <span class="logout-text">Logout</span>
    </a>

</aside>

  <!-- MAIN -->
  <main class="form-area">

    <div class="modal-box">

      <div class="modal-header">
        {{ 'New ' + category_label + ' habit' if mode=='new' else 'Edit habit' }}
      </div>

      <form method="POST" class="habit-form">

        <label>Habit description</label>
        <input
          type="text"
          name="name"
          value="{{ habit.name if mode=='edit' else '' }}"
          required
        >

        <label>Category</label>
        <select name="category" required>
          <option value="physical" {% if mode=='edit' and habit.category=='physical' %}selected{% endif %}>Physical health</option>
          <option value="mental" {% if mode=='edit' and habit.category=='mental' %}selected{% endif %}>Mental</option>
          <option value="social" {% if mode=='edit' and habit.category=='social' %}selected{% endif %}>Social</option>
          <option value="hobbies" {% if mode=='edit' and habit.category=='hobbies' %}selected{% endif %}>Hobbies</option>
        </select>

        <label>Periodicity</label>
        <select name="periodicity" id="periodicity" required>
            <option value="everyday" {% if mode=='edit' and habit.periodicity=='everyday' %}selected{% endif %}>Every day</option>
            <option value="every week" {% if mode=='edit' and habit.periodicity=='every week' %}selected{% endif %}>Every week</option>
            <option value="every month" {% if mode=='edit' and habit.periodicity=='every month' %}selected{% endif %}>Every month</option>
        </select>

        <label>Time / Frequency</label>

        <div id="dynamic-frequency"></div>

        <div class="btn-row">
          <button class="save-btn" type="submit">Save</button>
          <a class="cancel-btn" href="{{ url_for('main.habits_by_category', category=category) }}">Cancel</a>
        </div>

      </form>

    </div>

  </main>

</div>

<script>
  document.getElementById("toggle-btn").onclick = () => {
    document.getElementById("sidebar").classList.toggle("collapsed");
  };
</script>

<script>
function renderFrequencySelector() {
    const periodicity = document.getElementById("periodicity").value;
    const container = document.getElementById("dynamic-frequency");
    const existing = "{{ habit.frequency if mode=='edit' else '' }}";

    container.innerHTML = ""; 

    if (periodicity === "everyday") {
        container.innerHTML = `
            <input type="time" name="frequency" value="${existing}" required>
        `;
    }

    if (periodicity === "every week") {
        container.innerHTML = `
            <select name="frequency" required>
                <option value="Monday" ${existing==="Monday"?"selected":""}>Monday</option>
                <option value="Tuesday" ${existing==="Tuesday"?"selected":""}>Tuesday</option>
                <option value="Wednesday" ${existing==="Wednesday"?"selected":""}>Wednesday</option>
                <option value="Thursday" ${existing==="Thursday"?"selected":""}>Thursday</option>
                <option value="Friday" ${existing==="Friday"?"selected":""}>Friday</option>
                <option value="Saturday" ${existing==="Saturday"?"selected":""}>Saturday</option>
                <option value="Sunday" ${existing==="Sunday"?"selected":""}>Sunday</option>
            </select>
        `;
    }

    if (periodicity === "every month") {
        container.innerHTML = `
            <select name="frequency" required>
                <option value="1st week" ${existing==="1st week"?"selected":""}>1st week</option>
                <option value="2nd week" ${existing==="2nd week"?"selected":""}>2nd week</option>
                <option value="3rd week" ${existing==="3rd week"?"selected":""}>3rd week</option>
                <option value="4th week" ${existing==="4th week"?"selected":""}>4th week</option>
            </select>
        `;
    }
}

document.getElementById("periodicity").addEventListener("change", renderFrequencySelector);
window.onload = renderFrequencySelector;
</script>

</body>
</html>
